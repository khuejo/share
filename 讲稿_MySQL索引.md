# 开场白
大家好，今天和大家分享的是数据库索引，我将从以下3个方面进行分享： 
1. 数据库索引是什么？ 
2. 数据库索引实现的原理？ 
3. 以及如何使用数据库索引？

# 第一部分：是什么
数据库索引简单来说就是一种**数据结构**，这种数据结构用来协助快速查找数据库表中的数据。
索引有不同的分类规则，常见的分类如下：
- 按照实现：
  - 哈希索引
  - B树索引
  - 全文索引
- 按照存储：
  - 聚簇索引
  - 非聚簇索引
- 按照应用：
  - 主键索引
  - 二级/辅助索引
    - 唯一索引
    - 普通索引
- 按照数量：
  - 稀疏索引
    - 单列索引
    - 组合索引
  - 稠密索引
  - 全量索引

我们以mysql的索引为例来说明一下，我们知道，mysql是C/S架构，client通过连接器连接到server，
然后通过分析器、优化器，最后由执行器调用存储引擎的api来执行sql。
也就是说mysql中数据的存储与检索主要都是通过存储引擎来运作的。而mysql的存储引擎是插件式的，
也就是说开发人员可以自己选择，而mysql中常用的存储引擎是InnoDB，InnoDB中索引的底层数据结构是B+树。

B+树是一种多路平衡搜索树，
多路是指节点可能存在多个子节点。
平衡是指左右子树的高度差不会超过一个阈值，超过则需要旋转来实现平衡。
搜索树是指有序的树，一般指左子节点<父节点<右子节点。

要理解B+树，我们可以先了解B树，注意，是binary-tree，而不是balanced-tree。
- 二叉树：每个节点最多有两个子节点
- 二叉查找/搜索树/BST：基于二叉树，但是节点是有序的，最优为O(logN)，最差O(N)
- AVL树/平衡二叉查找树：基于二叉查找树，防止退化为链表，所以约定左右子树的高度差不超过1，最差O(logN)
- 2-3树：节点有1个数据则有2个子节点，节点有2个数据则有3个子节点
- 2-3-4树：基于2-3树，节点有3个数据则有4个子节点
- B树：
- B+树：

# 怎么用
- 适当构建索引，太多与太少都会影响查询的性能
- 失效场景
  - 不满足最佳左前缀法则
  - 使用了select *
  - 索引列使用了函数、计算（包括<>和!=）或存在类型转换
  - like以%开头
  - or前后存在非索引列
  - 字段允许为null，但使用了is not null
  - order by中没有使用where或limit
  - not in使用了非主键列
  - 使用了not exist
  - 优化器认为全表扫描比索引快
- 尽量使用join替换子查询，因为子查询会建立临时表，不存在索引，且查询结束后会撤销该临时表，产生额外的性能消耗
- 使用explain执行计划评估：关注type和extra字段
- 开启慢查询日志